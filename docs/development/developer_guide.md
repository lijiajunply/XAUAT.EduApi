# 新开发者入门文档

## 版本信息

| 版本 | 日期 | 更新内容 | 作者 |
|------|------|----------|------|
| 1.0 | 2024-12-02 | 初始创建 | 开发者团队 |

## 文档概述

本文档为新加入西安建筑科技大学教务系统API（XAUAT EduApi）项目的开发者提供入门指南，包括项目目录结构说明、编码规范、分支管理策略及提交信息规范。本文档旨在帮助新开发者快速熟悉项目，融入开发团队，遵循统一的开发规范。

## 目录

- [1. 项目简介](#1-项目简介)
  - [1.1 项目背景](#11-项目背景)
  - [1.2 项目目标](#12-项目目标)
  - [1.3 核心功能](#13-核心功能)
- [2. 项目目录结构](#2-项目目录结构)
  - [2.1 根目录结构](#21-根目录结构)
  - [2.2 API项目目录结构](#22-api项目目录结构)
  - [2.3 数据项目目录结构](#23-数据项目目录结构)
  - [2.4 测试项目目录结构](#24-测试项目目录结构)
  - [2.5 文档目录结构](#25-文档目录结构)
- [3. 开发环境搭建](#3-开发环境搭建)
  - [3.1 安装必要工具](#31-安装必要工具)
  - [3.2 克隆项目代码](#32-克隆项目代码)
  - [3.3 配置开发环境](#33-配置开发环境)
  - [3.4 运行项目](#34-运行项目)
  - [3.5 运行测试](#35-运行测试)
- [4. 编码规范](#4-编码规范)
  - [4.1 命名规范](#41-命名规范)
  - [4.2 代码格式规范](#42-代码格式规范)
  - [4.3 注释规范](#43-注释规范)
  - [4.4 代码结构规范](#44-代码结构规范)
- [5. 分支管理策略](#5-分支管理策略)
  - [5.1 分支类型](#51-分支类型)
  - [5.2 分支命名规范](#52-分支命名规范)
  - [5.3 分支操作流程](#53-分支操作流程)
  - [5.4 合并请求规范](#54-合并请求规范)
- [6. 提交信息规范](#6-提交信息规范)
  - [6.1 提交信息格式](#61-提交信息格式)
  - [6.2 提交信息类型](#62-提交信息类型)
  - [6.3 提交信息示例](#63-提交信息示例)
  - [6.4 提交信息最佳实践](#64-提交信息最佳实践)
- [7. 开发流程](#7-开发流程)
  - [7.1 需求分析](#71-需求分析)
  - [7.2 任务分配](#72-任务分配)
  - [7.3 代码开发](#73-代码开发)
  - [7.4 代码审查](#74-代码审查)
  - [7.5 测试验证](#75-测试验证)
  - [7.6 合并代码](#76-合并代码)
- [8. 常见开发任务](#8-常见开发任务)
  - [8.1 新增API端点](#81-新增api端点)
  - [8.2 新增业务逻辑](#82-新增业务逻辑)
  - [8.3 新增数据库表](#83-新增数据库表)
  - [8.4 修复bug](#84-修复bug)
  - [8.5 优化性能](#85-优化性能)
- [9. 代码审查标准](#9-代码审查标准)
  - [9.1 功能性审查](#91-功能性审查)
  - [9.2 代码质量审查](#92-代码质量审查)
  - [9.3 安全性审查](#93-安全性审查)
  - [9.4 性能审查](#94-性能审查)
  - [9.5 可维护性审查](#95-可维护性审查)
- [10. 常见问题与解决方案](#10-常见问题与解决方案)

## 1. 项目简介

### 1.1 项目背景

西安建筑科技大学教务系统API（XAUAT EduApi）是为西安建筑科技大学（XAUAT）的教务系统提供统一的数据访问接口的项目。该项目通过模拟登录和数据抓取，为移动应用和其他客户端提供标准化的RESTful API服务，解决了不同客户端需要重复开发数据抓取逻辑的问题，提高了开发效率和数据一致性。

### 1.2 项目目标

- 提供统一的教务系统数据访问接口
- 支持多种客户端应用（移动应用、Web应用等）
- 提高数据访问的安全性和可靠性
- 简化客户端开发流程，降低开发成本
- 支持系统的可扩展性和可维护性

### 1.3 核心功能

- **用户认证**：学生登录验证，获取访问令牌
- **课程信息**：获取学生课程表、课程详情
- **成绩查询**：查询各学期考试成绩
- **考试安排**：获取考试时间、地点安排
- **培养方案**：查询专业培养计划
- **学业进度**：查看学业完成情况
- **校园服务**：校车时刻表、校园卡消费记录
- **应用更新**：检查移动端应用最新版本

## 2. 项目目录结构

### 2.1 根目录结构

```
XAUAT.EduAp/
├── XAUAT.EduApi/             # API主项目
├── EduApi.Data/              # 数据模型和数据库访问层
├── Tests/                    # 测试项目
├── docs/                     # 项目文档
├── .gitignore                # Git忽略文件配置
├── Dockerfile                # Docker构建文件
├── LICENSE                   # 许可证文件
├── README.md                 # 项目说明文档
└── XAUAT.EduApi.sln          # 解决方案文件
```

### 2.2 API项目目录结构

```
XAUAT.EduApi/
├── Controllers/              # API控制器
├── Data/                     # 数据相关代码
├── Events/                   # 事件驱动相关代码
├── Extensions/               # 扩展方法
├── HealthChecks/             # 健康检查相关代码
├── Interfaces/               # 接口定义
├── Middlewares/              # 中间件
├── Plugins/                  # 插件系统
├── Repos/                    # 数据访问层
├── ServiceDiscovery/         # 服务发现相关代码
├── Services/                 # 业务逻辑层
├── appsettings.json          # 应用配置文件
├── appsettings.Development.json # 开发环境配置文件
├── Program.cs                # 应用入口文件
└── XAUAT.EduApi.csproj       # 项目文件
```

### 2.3 数据项目目录结构

```
EduApi.Data/
├── Models/                   # 数据模型
├── EduApi.Data.csproj        # 项目文件
```

### 2.4 测试项目目录结构

```
Tests/
├── UnitTests/                # 单元测试
├── IntegrationTests/         # 集成测试
└── Tests.csproj              # 测试项目文件
```

### 2.5 文档目录结构

```
docs/
├── api/                      # API文档
├── architecture/             # 架构设计文档
├── deployment/               # 部署指南
├── development/              # 开发指南
└── templates/                # 文档模板
```

## 3. 开发环境搭建

### 3.1 安装必要工具

1. **.NET SDK**：
   - 版本：10.0+ 
   - 下载地址：[https://dotnet.microsoft.com/zh-cn/download](https://dotnet.microsoft.com/zh-cn/download)

2. **开发工具**：
   - 推荐：Visual Studio 2022/2023、Rider 或 VS Code
   - VS Code 插件：
     - C# for Visual Studio Code
     - .NET Core Test Explorer
     - GitLens

3. **版本控制工具**：
   - Git：[https://git-scm.com/downloads](https://git-scm.com/downloads)
   - GitHub Desktop（可选）：[https://desktop.github.com/](https://desktop.github.com/)

4. **数据库工具**：
   - SQLiteStudio（开发环境）：[https://sqlitestudio.pl/](https://sqlitestudio.pl/)
   - DBeaver（多数据库支持）：[https://dbeaver.io/download/](https://dbeaver.io/download/)

5. **其他工具**：
   - Postman（API测试）：[https://www.postman.com/downloads/](https://www.postman.com/downloads/)
   - Redis Desktop Manager（Redis客户端）：[https://redisdesktop.com/download](https://redisdesktop.com/download)

### 3.2 克隆项目代码

1. **生成SSH密钥**（如果没有）：
   ```bash
   ssh-keygen -t rsa -b 4096 -C "your_email@example.com"
   ```

2. **添加SSH密钥到GitHub**：
   - 复制SSH公钥：`cat ~/.ssh/id_rsa.pub`
   - 登录GitHub，进入Settings > SSH and GPG keys > New SSH key
   - 粘贴公钥，添加密钥

3. **克隆项目代码**：
   ```bash
   git clone git@github.com:your-repo/XAUAT.EduAp.git
   cd XAUAT.EduAp
   ```

### 3.3 配置开发环境

1. **安装依赖**：
   ```bash
   dotnet restore
   ```

2. **配置开发环境变量**：
   - 复制 `appsettings.Development.json` 文件：
     ```bash
     cp XAUAT.EduApi/appsettings.Development.json XAUAT.EduApi/appsettings.Development.local.json
     ```
   - 编辑 `appsettings.Development.local.json` 文件，配置开发环境变量

3. **初始化数据库**：
   ```bash
   cd XAUAT.EduApi
   dotnet run
   ```
   开发环境使用SQLite数据库，系统会自动创建数据库文件

### 3.4 运行项目

1. **使用命令行运行**：
   ```bash
   cd XAUAT.EduApi
   dotnet run
   ```

2. **使用开发工具运行**：
   - 在Visual Studio/Rider中打开解决方案
   - 设置 `XAUAT.EduApi` 为启动项目
   - 点击运行按钮或按下F5

3. **验证项目是否成功运行**：
   - 访问 `http://localhost:8080/health`，返回健康检查结果
   - 访问 `http://localhost:8080/scalar/v1`，查看API文档

### 3.5 运行测试

1. **运行所有测试**：
   ```bash
   dotnet test
   ```

2. **运行指定项目的测试**：
   ```bash
   dotnet test Tests
   ```

3. **运行指定测试用例**：
   ```bash
   dotnet test --filter "Name~TestName"
   ```

## 4. 编码规范

### 4.1 命名规范

1. **命名原则**：
   - 使用有意义的名称，避免使用缩写和简写
   - 采用驼峰命名法或帕斯卡命名法，根据不同的命名对象选择合适的命名方式
   - 避免使用匈牙利命名法
   - 避免使用下划线（除了私有字段）

2. **具体命名规范**：
   | 对象类型 | 命名规范 | 示例 |
   |----------|----------|------|
   | 类名 | 帕斯卡命名法，名词或名词短语 | `UserController` |
   | 接口名 | 帕斯卡命名法，以I开头，名词或名词短语 | `IUserService` |
   | 方法名 | 帕斯卡命名法，动词或动词短语 | `GetUserInfo` |
   | 变量名 | 驼峰命名法 | `userName` |
   | 私有字段 | 驼峰命名法，以_开头 | `_userRepository` |
   | 常量名 | 全大写，单词间用下划线分隔 | `MAX_RETRY_COUNT` |
   | 枚举名 | 帕斯卡命名法 | `UserRole` |
   | 枚举值 | 帕斯卡命名法 | `Admin` |
   | 命名空间 | 帕斯卡命名法 | `XAUAT.EduApi.Controllers` |
   | 文件名 | 帕斯卡命名法，与类名保持一致 | `UserController.cs` |

### 4.2 代码格式规范

1. **缩进**：
   - 使用4个空格进行缩进，不使用制表符
   - 花括号 `{` 放在行尾，而不是新行
   - 控制流语句（if、for、while等）的花括号必须使用，即使只有一行代码

2. **行宽**：
   - 每行代码不超过120个字符
   - 过长的行应适当换行，保持代码可读性

3. **空格**：
   - 在逗号、分号后添加空格
   - 在运算符两侧添加空格
   - 在括号内侧不加空格
   - 在方法名和括号之间不加空格

4. **空行**：
   - 在类的不同成员之间添加空行
   - 在方法内部的逻辑块之间添加空行
   - 避免连续的空行

### 4.3 注释规范

1. **注释原则**：
   - 注释应清晰、简洁，避免冗余
   - 注释应解释代码的"为什么"，而不是"是什么"
   - 代码本身应尽可能自解释
   - 定期更新注释，确保注释与代码一致

2. **XML注释**：
   - 为公开的类、方法、属性添加XML注释
   - 包含摘要、参数说明、返回值说明和异常说明
   - 使用 `<summary>`、`<param>`、`<returns>`、`<exception>` 等标签

3. **单行注释**：
   - 使用 `//` 添加单行注释
   - 注释应与被注释的代码在同一行或前一行
   - 避免不必要的单行注释

4. **多行注释**：
   - 使用 `/* */` 添加多行注释
   - 主要用于文件头部说明、版权信息等
   - 避免在代码中间使用多行注释

### 4.4 代码结构规范

1. **类结构**：
   - 类的成员顺序：构造函数、公共属性、公共方法、私有方法、私有字段
   - 接口实现应按接口方法顺序排列
   - 重载方法应放在一起

2. **方法结构**：
   - 方法应保持简洁，一个方法只做一件事
   - 方法的参数不超过5个
   - 过长的方法应拆分为多个小方法

3. **异常处理**：
   - 使用try-catch块处理异常
   - 只捕获已知的异常类型，避免捕获所有异常
   - 在catch块中添加有意义的日志
   - 避免在finally块中抛出异常

4. **异步编程**：
   - 使用async/await进行异步编程
   - 异步方法名以Async结尾
   - 避免混合使用同步和异步代码

## 5. 分支管理策略

### 5.1 分支类型

1. **主分支（main）**：
   - 稳定的生产版本分支
   - 只接受来自develop分支的合并请求
   - 每次合并后打标签，用于发布

2. **开发分支（develop）**：
   - 集成所有开发功能的分支
   - 接受来自feature分支的合并请求
   - 用于测试和集成

3. **特性分支（feature/**）**：
   - 用于开发新功能的分支
   - 从develop分支创建
   - 开发完成后合并回develop分支

4. **修复分支（fix/**）**：
   - 用于修复bug的分支
   - 从main或develop分支创建
   - 修复完成后合并回对应的分支

5. **发布分支（release/**）**：
   - 用于准备发布的分支
   - 从develop分支创建
   - 进行发布前的测试和修复
   - 发布完成后合并回main和develop分支

### 5.2 分支命名规范

| 分支类型 | 命名规范 | 示例 |
|----------|----------|------|
| 主分支 | main | main |
| 开发分支 | develop | develop |
| 特性分支 | feature/feature-name | feature/login-system |
| 修复分支 | fix/bug-description | fix/login-error |
| 发布分支 | release/version-number | release/1.0.0 |

### 5.3 分支操作流程

1. **创建特性分支**：
   ```bash
   git checkout develop
   git pull
   git checkout -b feature/feature-name
   ```

2. **开发功能**：
   - 在特性分支上进行开发
   - 定期提交代码
   - 定期从develop分支合并最新代码
   ```bash
   git pull origin develop
   ```

3. **完成特性开发**：
   - 运行所有测试，确保测试通过
   - 提交所有代码
   ```bash
   git add .
   git commit -m "feat: 完成特性开发"
   git push origin feature/feature-name
   ```

4. **创建合并请求**：
   - 在GitHub上创建从feature/feature-name到develop的合并请求
   - 等待代码审查
   - 根据审查意见进行修改

5. **合并特性分支**：
   - 代码审查通过后，合并到develop分支
   - 删除特性分支

### 5.4 合并请求规范

1. **合并请求标题**：
   - 简洁明了，描述合并请求的主要内容
   - 格式：`[分支类型] 简要描述`
   - 示例：`[Feature] 实现用户登录功能`

2. **合并请求描述**：
   - 详细描述合并请求的内容
   - 包含实现的功能、修改的文件、相关的问题或需求
   - 包含测试结果
   - 包含相关的截图或链接

3. **合并请求审查**：
   - 至少需要1个审查者批准
   - 审查者应检查代码质量、功能完整性、测试覆盖等
   - 审查者应提出具体的修改意见

4. **合并请求冲突**：
   - 解决合并冲突后才能合并
   - 优先使用rebase方式解决冲突

## 6. 提交信息规范

### 6.1 提交信息格式

```
<type>(<scope>): <subject>

<body>

<footer>
```

- **type**：提交类型
- **scope**：提交的范围（可选）
- **subject**：提交的简要描述
- **body**：提交的详细描述（可选）
- **footer**：相关的issue或需求链接（可选）

### 6.2 提交信息类型

| 类型 | 说明 |
|------|------|
| feat | 新增功能 |
| fix | 修复bug |
| docs | 文档修改 |
| style | 代码格式修改（不影响功能） |
| refactor | 代码重构（不影响功能） |
| perf | 性能优化 |
| test | 测试相关修改 |
| build | 构建相关修改 |
| ci | CI/CD配置修改 |
| chore | 其他修改（如配置文件、依赖更新等） |

### 6.3 提交信息示例

```
feat(login): 实现用户登录功能

- 添加LoginController和相关接口
- 实现用户名密码验证
- 添加JWT令牌生成

Resolves: #123
```

```
fix(course): 修复课程列表查询错误

- 修复CourseService中的查询逻辑
- 添加参数验证
- 优化数据库查询

Related to: #456
```

### 6.4 提交信息最佳实践

1. **提交信息应清晰、简洁**：
   - 标题不超过50个字符
   - 主体不超过72个字符
   - 使用祈使句，现在时态
   - 首字母小写，不使用句号结尾

2. **每次提交只做一件事**：
   - 避免一次提交多个不相关的修改
   - 相关的修改应放在同一提交中

3. **提交前运行测试**：
   - 确保所有测试通过
   - 确保代码格式符合规范

4. **使用有意义的提交信息**：
   - 描述具体的修改内容，而不是笼统的描述
   - 解释为什么做这个修改，而不是怎么做的

## 7. 开发流程

### 7.1 需求分析

1. **需求收集**：从产品经理、用户反馈、技术文档等渠道收集需求
2. **需求分析**：分析需求的可行性、优先级、影响范围
3. **需求拆分**：将大需求拆分为多个小任务
4. **任务分配**：根据开发人员的技能和工作量分配任务

### 7.2 任务分配

1. **创建任务**：在项目管理工具（如GitHub Issues、Jira）中创建任务
2. **任务描述**：详细描述任务的需求、验收标准、时间估算等
3. **任务优先级**：根据需求的重要性和紧急性设置优先级
4. **任务分配**：将任务分配给相应的开发人员

### 7.3 代码开发

1. **创建分支**：根据任务类型创建相应的分支
2. **代码编写**：按照编码规范编写代码
3. **单元测试**：为新功能编写单元测试
4. **代码审查**：定期进行自我审查，确保代码质量

### 7.4 代码审查

1. **创建合并请求**：完成代码开发后，创建合并请求
2. **代码审查**：其他开发人员审查代码，提出修改意见
3. **修改代码**：根据审查意见修改代码
4. **重新审查**：修改完成后，再次进行代码审查

### 7.5 测试验证

1. **单元测试**：运行单元测试，确保代码的正确性
2. **集成测试**：运行集成测试，确保模块间的协作正常
3. **系统测试**：在测试环境中进行系统测试，确保功能符合需求
4. **验收测试**：由产品经理或测试人员进行验收测试

### 7.6 合并代码

1. **合并到develop分支**：代码审查通过后，合并到develop分支
2. **合并到main分支**：发布前，将develop分支合并到main分支
3. **打标签**：在main分支上打发布标签
4. **部署发布**：将发布版本部署到生产环境

## 8. 常见开发任务

### 8.1 新增API端点

1. **创建或更新控制器**：在Controllers目录下创建或更新控制器
2. **添加路由属性**：为API方法添加HttpGet/HttpPost等路由属性
3. **实现业务逻辑**：在Service层实现业务逻辑
4. **添加接口定义**：在Interfaces目录下添加接口定义
5. **编写XML注释**：为API方法添加详细的XML注释
6. **编写单元测试**：为新API编写单元测试
7. **更新API文档**：确保API文档与代码一致

### 8.2 新增业务逻辑

1. **创建服务类**：在Services目录下创建服务类
2. **实现接口**：实现相应的接口
3. **添加依赖注入**：在ServiceCollectionExtensions中添加依赖注入
4. **编写业务逻辑**：实现具体的业务逻辑
5. **处理异常**：添加适当的异常处理
6. **编写单元测试**：为新业务逻辑编写单元测试

### 8.3 新增数据库表

1. **创建数据模型**：在EduApi.Data.Models中创建数据模型
2. **添加DbSet**：在EduContext中添加DbSet属性
3. **创建迁移**：使用EF Core创建迁移
   ```bash
   cd XAUAT.EduApi
   dotnet ef migrations add AddTableName
   ```
4. **应用迁移**：将迁移应用到数据库
   ```bash
   dotnet ef database update
   ```
5. **更新数据库访问层**：更新Repos目录下的数据访问代码
6. **编写单元测试**：为新数据模型编写单元测试

### 8.4 修复bug

1. **定位问题**：通过日志、调试等方式定位bug
2. **分析原因**：分析bug产生的根本原因
3. **修复代码**：修改相应的代码
4. **编写测试用例**：为bug修复编写测试用例
5. **验证修复**：运行测试，确保bug已修复
6. **更新文档**：如果bug修复影响了文档，更新相应的文档

### 8.5 优化性能

1. **性能分析**：使用性能分析工具分析性能瓶颈
2. **优化数据库查询**：优化SQL查询，添加索引
3. **优化代码**：重构低效的代码
4. **添加缓存**：使用Redis等缓存提高性能
5. **异步编程**：使用async/await优化I/O操作
6. **性能测试**：进行性能测试，验证优化效果

## 9. 代码审查标准

### 9.1 功能性审查

- 代码是否实现了预期的功能
- 代码是否符合需求规格
- 代码是否处理了边界情况
- 代码是否处理了异常情况

### 9.2 代码质量审查

- 代码是否符合编码规范
- 代码是否简洁、清晰、易于理解
- 代码是否有适当的注释
- 代码是否存在冗余
- 代码是否存在重复

### 9.3 安全性审查

- 代码是否存在安全漏洞
- 代码是否处理了输入验证
- 代码是否处理了认证和授权
- 代码是否处理了敏感数据
- 代码是否存在SQL注入、XSS等安全问题

### 9.4 性能审查

- 代码是否存在性能瓶颈
- 数据库查询是否高效
- 是否使用了适当的缓存
- 是否避免了不必要的I/O操作
- 代码是否存在内存泄漏

### 9.5 可维护性审查

- 代码是否易于维护
- 代码是否易于扩展
- 代码是否使用了适当的设计模式
- 代码是否存在硬编码
- 代码是否依赖于具体的实现而不是接口

## 10. 常见问题与解决方案

| 问题 | 解决方案 |
|------|----------|
| 无法连接到数据库 | 检查数据库连接字符串是否正确，数据库服务是否正常运行 |
| 编译错误 | 检查代码是否符合C#语法规范，是否缺少依赖 |
| 运行时错误 | 查看日志文件，定位错误原因，修复代码 |
| Git冲突 | 解决冲突后重新提交代码 |
| 测试失败 | 检查测试用例是否正确，代码是否存在bug |
| 性能问题 | 使用性能分析工具定位瓶颈，优化代码 |

## 更新日志

| 日期 | 版本 | 更新内容 | 作者 |
|------|------|----------|------|
| 2024-12-02 | 1.0 | 初始创建 | 开发者团队 |

## 相关资源

- [项目GitHub仓库](https://github.com/your-repo/XAUAT.EduAp)
- [API文档](/scalar/v1)（部署后可访问）
- [架构设计文档](../architecture/architecture.md)
- [部署指南](../deployment/deployment.md)
